# CLab for EDA

写在前面：CLab 团队充分尊重知识产权，在使用软件前，确保您有正确的软件授权。

## 支持矩阵

1. 操作系统：`almalinux` 8.10。`almalinux`是`EL`系系统，基于 RHEL 修改得到，具有良好兼容性。其生命周期到 2029 年 5 月。预期于 2025 年秋学期支持`almalinux 9`。
2. 硬件：支持`x86_64`架构处理器，CPU 大于等于 2 核心，内存大于等于 4GB
3. 软件：目前支持`Synopsys`、`Cadence`、`Mentor`等软件的`2020`版本。华大九天 EDA 经测试可以正常运行，但 license 需要授课组联系 CLab 对接。如果您有其他软件需求，请联系我们
4. 远程桌面：支持北京大学长沙计算与数字经济研究院的`shadowdesk`远程桌面软件。该软件可以在浏览器访问远程 Linux 系统，具有剪贴板同步、文件传输等功能，符合 EDA 的需要

## 目标用户

CLab 交流 QQ 群号为`432191140`，我们会在群内回答您的问题，欢迎加入。

1. 对于课程组织者，请阅读`对于课程组织者`部分。您可能需要与我们联系，处理账号和权限相关问题，请发送邮件至`linuxclub@pku.edu.cn`，我们将在一个工作日内反馈
2. 如果您是选课同学，请阅读`对于课程参与者`部分
3. 如您为科研使用，您可以发送具体需求至社团邮箱`linuxclub@pku.edu.cn`，我们会根据您的需求进行评估，但是由于资源紧张，我们可能无法满足您的需求
4. 对于其他同学，您仍然可以自由使用 CLab

## 对于课程组织者

登录`https://clab.pku.edu.cn`。推荐您先阅读[快速开始](https://clab.pku.edu.cn/docs/getting-started/introduction)文档，了解 CLab 的基础使用。

课程可以申请`8c16g`配额的管理账号。如果您需要更多资源，请邮件联系我们。

### 创建课程网络

对于课程，可以创建课程专用网络，通过 NFS 方式共享文件，方便课程资源分发。具体操作如下：

在左边栏选中`网络-网络`，进入网络列表

1. 填写网络名称，推荐使用课程相关的名称，比如`ics2024`
2. 勾选”创建子网“，填写子网名称，比如`v4`，版本保持`IPv4`不变
3. 填写子网网段，可以使用`192.168.102.0/23`
4. 展开高级设置，勾选”禁用网关“，点击确定，创建网络

**复制网络 ID**，以便提交给 CLab 管理团队

### 创建 EDA 网络

大部分 EDA 应用需要固定 MAC 地址，可以通过创建 EDA 专用网络来实现。具体操作如下：

![](/assets/courses/eda/create_network1.png)

在左边栏选中`网络-网络`，进入网络列表

![](/assets/courses/eda/create_network2.png)

1. 填写网络名称，名称随意，比如`eda`
2. 勾选”创建子网“，填写子网名称，比如`v4`，版本保持`IPv4`不变
3. 填写子网网段，可以使用`192.168.100.0/24`
4. 展开高级设置，勾选”禁用网关“，点击确定，创建网络

注意，描述不能出现中文字符。

在左边栏选中`网络-端口`，点击”创建虚拟网卡“

![](/assets/courses/eda/create_nic.png)

1. 填写网卡名称，名称随意，比如`eda`
2. 选择网络，选择刚刚创建的 EDA 网络
3. 选择所属子网，选择刚刚创建的 EDA 子网
4. 在`Mac地址`处选择”手动输入“。填写具体`Mac地址`。该项与证书相关，授课教师可自备，也可发向 CLab 询问。选课同学由助教提供
5. 选择安全组，使用`default`即可
6. 点击确定，创建虚拟网卡

### 创建课程管理主机

在左边栏选中`计算-云主机`，进入云主机列表，点击`创建云主机`

![](/assets/getting-started/move-to-vm-list.png)

#### 第一页

![](/assets/courses/eda/create_vm.jpg)

1. 选择规格：使用`elite_computing`分类，类型为`e4`
2. 选择操作系统：使用`CentOS`分类，选择`CLab EDA`
3. 选择硬盘：点击“是-创建云硬盘”，使用`SSD`类型，大小为`200GB`

#### 第二页

![](/assets/courses/eda/config_net.png)

选择网络：首先勾选”共享网络“中的`pku-new`，然后勾选”当前项目网络“中的课程相关网络。顺序不能颠倒

暂时不要选择`eda`网络，进入下一步

#### 第三页

1. 填写名称，比如`ics2024-admin`
2. 选择密钥。如果添加过密钥，可以选择“创建密钥”，在“导入密钥”处选择已有密钥

点击两次确定，创建机器。等待主机状态从“创建中“变为“运行中“。这一步可能需要等待几分钟，可以刷新页面查看状态

#### 创建后

在左边栏选中`网络-端口`，找到刚刚创建的，特定 Mac 地址的虚拟网卡，点击”更多-绑定云主机”，选中刚刚创建的管理主机，点击确定

### 登录主机

通过主机的 IP 地址登录主机，进行后续操作，用户名是`almalinux`。例如：

```plain
ssh almalinux@10.129.242.10
```

启动 EDA 证书管理服务：

```plain
sudo systemctl enable --now lmg
```

#### 创建`NFS`共享

1. 在管理主机上，安装`NFS`服务：

```plain
sudo dnf install nfs-utils -y
```

2. 创建共享目录：

```plain
sudo mkdir /mnt/nfs
```

编辑`/etc/exports`文件，添加如下内容。以下内容的含义是允许`192.168.102.0/23`（也就是课程网络）的主机访问`/mnt/nfs`目录，拥有只读权限

```plain
/mnt/nfs 192.168.102.0/23(ro,async,all_squash)
```

3. 启动`NFS`服务：

```plain
sudo systemctl enable --now nfs-server
```

#### 连接远程桌面

使用`clabcli remote`命令，输入您的学号或者工号，即可使用远程桌面。您可以通过家目录中`rd_password`文件，或者再次输入`clabcli desktop`命令，查看远程桌面的密码。

访问`https://rdv2.lcpu.dev`，使用账号密码登录，即可使用远程桌面。

#### 连接北大网关（可选）

如您需要使用互联网，或者使用 vscode 连接远程主机，您需要连接北大网关。您可以使用`clabcli connect`命令，输入您的学号或者工号，即可连接北大网关。连接成功后，您可以使用`clabcli disconnect`命令断开连接。

### 提交信息至 CLab 管理团队

您需要提交的信息有：

1. 课程名称
2. 课程使用的账号名
3. 用来创建 NFS 的课程网络 ID
4. 选课名单，包括学号和姓名
5. CLab 使用开始日期

您需要提醒同学在 CLab 使用开始日期前登录`https://clab.pku.edu.cn`，进行账号激活，否则将无法连接到 NFS 共享

## 对于课程参与者

### 创建 EDA 网络

大部分 EDA 应用需要固定 MAC 地址，可以通过创建 EDA 专用网络来实现。具体操作如下：

![](/assets/courses/eda/create_network1.png)

在左边栏选中`网络-网络`，进入网络列表

![](/assets/courses/eda/create_network2.png)

1. 填写网络名称，名称随意，比如`eda`
2. 勾选”创建子网“，填写子网名称，比如`v4`，版本保持`IPv4`不变
3. 填写子网网段，可以使用`192.168.100.0/24`
4. 展开高级设置，勾选”禁用网关“，点击确定，创建网络

注意，描述不能出现中文字符。

在左边栏选中`网络-端口`，点击”创建虚拟网卡“

![](/assets/courses/eda/create_nic.png)

1. 填写网卡名称，名称随意，比如`eda`
2. 选择网络，选择刚刚创建的 EDA 网络
3. 选择所属子网，选择刚刚创建的 EDA 子网
4. 在`Mac地址`处选择”手动输入“。填写具体`Mac地址`。如不清楚，请询问助教
5. 选择安全组，使用`default`即可
6. 点击确定，创建虚拟网卡

### 创建课程主机

在左边栏选中`计算-云主机`，进入云主机列表，点击`创建云主机`

![](/assets/getting-started/move-to-vm-list.png)

#### 第一页

![](/assets/courses/eda/create_vm.jpg)

1. 选择规格：使用`elite_computing`分类，类型为`e4`
2. 选择操作系统：使用`其他`分类，选择`CLab EDA`
3. 选择硬盘：点击“是-创建云硬盘”，使用`SSD`类型，大小为`150GB`

#### 第二页

![](/assets/courses/eda/config_net.png)

选择网络：首先勾选”共享网络“中的`pku-new`，然后勾选”当前项目网络“中的课程相关网络。顺序不能颠倒

暂时不要选择`eda`网络，进入下一步

#### 第三页

1. 填写名称，比如`ics2024`
2. 选择密钥。如果添加过密钥，可以选择“创建密钥”，在“导入密钥”处选择已有密钥

点击两次确定，创建机器。等待主机状态从“创建中“变为“运行中“。这一步可能需要等待几分钟，可以刷新页面查看状态

#### 创建后

在左边栏选中`网络-端口`，找到刚刚创建的，特定 Mac 地址的虚拟网卡，点击”更多-绑定云主机”，选中刚刚创建的管理主机，点击确定

### 登录主机

通过主机的 IP 地址登录主机，进行后续操作，用户名是`almalinux`。例如：

```plain
ssh almalinux@10.129.242.10
```

启动 EDA 证书管理服务：

```plain
sudo systemctl enable --now lmg
```

#### 连接远程桌面

使用`clabcli desktop`命令，输入您的学号或者工号，即可使用远程桌面。您可以通过家目录中`rd_password`文件，或者再次输入`clabcli desktop`命令，查看远程桌面的密码。

访问`https://rdv2.lcpu.dev`，使用账号密码登录，即可使用远程桌面。

#### 连接北大网关（可选）

如您需要使用互联网，或者使用 vscode 连接远程主机，您需要连接北大网关。您可以使用`clabcli connect`命令，输入您的学号或者工号，即可连接北大网关。连接成功后，您可以使用`clabcli disconnect`命令断开连接。
